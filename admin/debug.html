<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Debug - Arteamo</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #f5f5f5;
        }
        .test {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #ccc;
        }
        .pass { border-left-color: green; }
        .fail { border-left-color: red; }
        pre { background: #f0f0f0; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Admin Panel Debug</h1>
    <div id="results"></div>
    
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        const results = document.getElementById('results');
        
        function addTest(name, passed, details) {
            const div = document.createElement('div');
            div.className = 'test ' + (passed ? 'pass' : 'fail');
            div.innerHTML = `
                <strong>${name}:</strong> ${passed ? '✓ PASS' : '✗ FAIL'}
                ${details ? '<pre>' + details + '</pre>' : ''}
            `;
            results.appendChild(div);
        }
        
        // Test 1: Identity widget loaded
        setTimeout(() => {
            const identityLoaded = typeof window.netlifyIdentity !== 'undefined';
            addTest('Identity Widget Loaded', identityLoaded, 
                identityLoaded ? 'netlifyIdentity is available' : 'netlifyIdentity is NOT available');
            
            // Test 2: Initialize Identity
            if (identityLoaded) {
                try {
                    window.netlifyIdentity.init({
                        APIUrl: window.location.origin + "/.netlify/identity"
                    });
                    addTest('Identity Initialized', true, 'Identity widget initialized');
                } catch (e) {
                    addTest('Identity Initialized', false, e.toString());
                }
            }
            
            // Test 3: Check for tokens
            const hash = window.location.hash;
            const hasToken = hash && (
                hash.includes('recovery_token=') ||
                hash.includes('invite_token=') ||
                hash.includes('confirmation_token=') ||
                hash.includes('token=')
            );
            addTest('Token in URL', hasToken, hasToken ? hash : 'No token found');
            
            // Test 4: admin.js loaded
            const adminLoaded = typeof adminApp !== 'undefined';
            addTest('admin.js Loaded', adminLoaded, 
                adminLoaded ? 'adminApp is available' : 'adminApp is NOT available');
            
            // Test 5: Check DOM elements
            const authScreen = document.getElementById('authScreen');
            const adminInterface = document.getElementById('adminInterface');
            addTest('DOM Elements', authScreen && adminInterface, 
                `authScreen: ${!!authScreen}, adminInterface: ${!!adminInterface}`);
            
            // Test 6: CSP check
            const cspErrors = [];
            if (window.console && console.error) {
                const originalError = console.error;
                console.error = function(...args) {
                    if (args.some(arg => typeof arg === 'string' && arg.includes('CSP'))) {
                        cspErrors.push(args.join(' '));
                    }
                    originalError.apply(console, args);
                };
            }
            addTest('CSP Issues', cspErrors.length === 0, 
                cspErrors.length > 0 ? cspErrors.join('\n') : 'No CSP errors detected');
            
        }, 1000);
    </script>
</body>
</html>
